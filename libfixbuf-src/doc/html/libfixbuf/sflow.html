
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>fixbuf- Documentation</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <link rel="stylesheet" type="text/css" href="../../site/style.css" />
        <link rel="stylesheet" type="text/css" href="doxygen.css">
        <link rel="stylesheet" type="text/css" href="tabs.css">
</head>
<body>
    <div id="p-body">
      <div id="l-header">
        <img src="../../site/sei-logo.png" id="l-sei-logo"
            alt="Software Engineering Institute | Carnegie Mellon&copy;" />
        <div id="l-netsa-logo"><a id="l-netsa-name" href="../../index.html"><b>CERT NetSA Security Suite</b></a></div>
        <div id="l-netsa-motto">Monitoring for Large-Scale Networks</div>
        <h1 class="l-page-title">fixbuf</h1>
        <span id="l-subtitle">Documentation</span>
      </div><!-- l-header -->
      <div id="l-content">
        <div id="l-sidebar">
          <div class="p-sidebar-section">
            <h1><a href="../index.html">fixbuf</a></h1>
            <ul>
              <li><a href="index.html">Documentation</a></li>
              <li><a href="../download.html">Downloads</a></li>
	      <li><a href="../../pyfixbuf/index.html">pyfixbuf</a></li>
            </ul>
          </div><!-- p-sidebar-section -->
        </div><!-- l-sidebar -->
      <div id="top"> <!-- need this for doxygen -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sFlow Collectors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>How to use libfixbuf to collect sFlow v5</p>
<p>libfixbuf can be used to collect sFlow and convert sFlow to IPFIX. Follow the steps above to create an fbListener. After creating the listener, retrieve the collector by calling <a class="el" href="public_8h.html#a7e64858b1a8766f7e2889b1de70fca97" title="fbListenerGetCollector ">fbListenerGetCollector()</a> before calling <a class="el" href="public_8h.html#a91e50cd60e8a848fcd5191da59c2bad0" title="fbCollectorSetSFlowTranslator ">fbCollectorSetSFlowTranslator()</a>. Essentially, the libfixbuf translator is an IPFIX mediator which converts sFlow to IPFIX. sFlow v5 is a fixed format protocol. The same steps are used to retrieve flow records from the buffer, call <a class="el" href="public_8h.html#a11c40f1d55e2d4b29b40eb4c07ce5ee7" title="Retrieve a record from a buffer. ">fBufNext()</a>. The internal template should contain some subset of the fields listed below. sFlow Data Records will have a template ID of 0xEEEE and the Options Records will have a template ID of 0xEEEF.</p>
<p>Fixbuf first reads the sFlow header to ensure the buffer contains sFlow v5. Fixbuf currently only has support for sFlow v5. The sFlow header only contains the time since the device last rebooted (but not the time of reboot) and this time will be reported in the systemInitTimeMilliseconds field. Fixbuf records the time that the sFlow message was received in the collectionTimeMilliseconds field. Once the first message has been received, the translator will create an external buffer and export the fixed templates to the fixbuf session. Note: the first sFlow message that fixbuf receives will not be processed - this is used to setup the translation process. The translator will keep track of sequence numbers per peer (IP)/observation domain (agent ID) by default. Use <a class="el" href="public_8h.html#a2efc61d324cb411b9a4c32acff0bc72c" title="An attempt to fix what some netflow v9 exporters do wrong. ">fbCollectorManageUDPStreamByPort()</a> to differentiate sessions by IP, port, and observation domain. There are multiple sequence numbers in sFlow. Each sFlow message has a sequence number and each sample has a sequence number. The sFlow message sequence number is used to determine if sFlow messages have been dropped. Fixbuf will report if either sequence number is out of sequence and emit a warning. The warning is just for notification, libfixbuf will process all well-formed samples that it receives.</p>
<p>libfixbuf will process Flow Samples (1), Extended Flow Samples (3), Counter Samples (2), and Extended Counter Samples (4). Any other format will return an FB_ERROR_SFLOW. Applications should ignore (and potentially log) FB_ERROR_SFLOW errors. FB_ERROR_SFLOW errors are not fatal. With an sFlow sample, fixbuf can handle the following formats:</p>
<ul>
<li>Raw Packet Data, enterprise = 0, format = 1</li>
<li>Ethernet Frame Data, enterprise = 0, format = 2</li>
<li>IPv4 Data, enterprise = 0, format = 3</li>
<li>IPv6 Data, enterprise = 0, format = 4</li>
<li>Extended Switch data, enterprise = 0, format = 1001</li>
<li>Extended Router data, enterprise = 0, format = 1002</li>
<li>Extended Gatway Data, enterprise = 0, format = 1003</li>
</ul>
<p>Any other flow sample format will be silently ignored. Each sFlow flow record can contain the following fields, formats are listed in the parenthesis:</p>
<table class="doxtable">
<tr>
<th>IPFIX FIELDS </th><th>sFlow FIELDS </th><th>Reduced Length  </th></tr>
<tr>
<td>sourceIPv6Address </td><td>Ipv6 Address in IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>destinationIPv6Address </td><td>Ipv6 Address in IPv6 (4) or Raw Packet (1) Data</td><td>N </td></tr>
<tr>
<td>ipNextHopIPv6Address </td><td>Extended Router Data (1002) </td><td>N </td></tr>
<tr>
<td>bgpNextHopIPv6Address </td><td>Extended Gateway Data (1003) </td><td>N </td></tr>
<tr>
<td>collectorIPv6Address </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>collectionTimeMilliseconds </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>systemInitTimeMilliseconds </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>collectorIPv4Address </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>protocolIdentifier </td><td>IPv4 (3) or IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>ipClassOfService </td><td>IPv4 (3) or IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>sourceIPv4PrefixLength </td><td>Extended Router Data (1002) </td><td>N </td></tr>
<tr>
<td>destinationIPv4PrefixLength </td><td>Extended Router Data (1002) </td><td>N </td></tr>
<tr>
<td>sourceIPv4Address </td><td>IPv4 (3) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>destinationIPv4Address </td><td>IPv4 (3) or Raw Packet (1) Data</td><td>N </td></tr>
<tr>
<td>octetTotalCount </td><td>Flow Sample Header Data </td><td>4 </td></tr>
<tr>
<td>packetTotalCount </td><td>Flow Sample Header Data </td><td>4 </td></tr>
<tr>
<td>ingressInterface </td><td>Flow Sample Header Data </td><td>N </td></tr>
<tr>
<td>egressInterface </td><td>Flow Sample Header Data </td><td>N </td></tr>
<tr>
<td>sourceMacAddress </td><td>Ethernet (2), IPv4 (3), IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>destinationMacAddress </td><td>Ethernet (2), IPv4 (3), IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>ipNextHopIPv4Address </td><td>Extended Router Data (1002) </td><td>N </td></tr>
<tr>
<td>bgpSourceAsNumber </td><td>Extended Gateway Data (1003)</td><td>N </td></tr>
<tr>
<td>bgpDestinationAsNumber</td><td>Extended Gateway Data (1003) </td><td>N </td></tr>
<tr>
<td>bgpNextHopIPv4Address</td><td>Extended Gateway Data (1003) </td><td>N </td></tr>
<tr>
<td>samplingPacketInterval </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>samplingPopulation</td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>droppedPacketTotalCount</td><td>Message Header Data </td><td>4 </td></tr>
<tr>
<td>selectorId</td><td>Message Header Data </td><td>4 </td></tr>
<tr>
<td>vlanId </td><td>IPv4 (3) or IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>sourceTransportPort </td><td>IPv4 (3) or IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>destinationTransportPort </td><td>IPv4 (3) or IPv6 (4) or Raw Packet (1) Data </td><td>N </td></tr>
<tr>
<td>tcpControlBits </td><td>IPv4 (3) or IPv6 (4) or Raw Packet (1) Data </td><td>2 </td></tr>
<tr>
<td>dot1qVlanId </td><td>Extended Switch Data (1001) </td><td>N </td></tr>
<tr>
<td>postDot1qVlanId </td><td>Extended Switch Data (1001) </td><td>N </td></tr>
<tr>
<td>dot1qPriority </td><td>Extended Switch Data (1001) </td><td>N </td></tr>
</table>
<p>libfixbuf will also convert sFlow Counter Records to Options Records in IPFIX. libfixbuf will only process the Generic Interface Counters (format = 1). Other formats will be silently ignored. The following fields are present in the Counter (Options) Template/Record:</p>
<table class="doxtable">
<tr>
<th>IPFIX FIELDS </th><th>sFlow FIELDS </th><th>Reduced Length  </th></tr>
<tr>
<td>collectorIPv6Address </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>collectionTimeMilliseconds </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>systemInitTimeMilliseconds </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>collectorIPv4Address </td><td>Message Header Data </td><td>N </td></tr>
<tr>
<td>ingressInterface </td><td>Counter Sample Header Data </td><td>N </td></tr>
<tr>
<td>octetTotalCount </td><td>ifINOctets (1) </td><td>N </td></tr>
<tr>
<td>ingressInterfaceType </td><td>ifType (1) </td><td>N </td></tr>
<tr>
<td>packetTotalCount </td><td>ifInUcastPkts (1) </td><td>4 </td></tr>
<tr>
<td>ingressMulticastPacketTotalCount </td><td>ifInMulticastPkts (1) </td><td>4 </td></tr>
<tr>
<td>ingressBroadcastPacketTotalCount </td><td>ifInBroadcastPkts (1) </td><td>4 </td></tr>
<tr>
<td>notSentPacketTotalCount </td><td>ifInDiscards (1) </td><td>4 </td></tr>
<tr>
<td>droppedPacketTotalCount </td><td>ifInErrors (1) </td><td>4 </td></tr>
<tr>
<td>postOctetTotalCount </td><td>ifOutOctets (1) </td><td>N </td></tr>
<tr>
<td>ignoredPacketTotalCount </td><td>ifInUnknownProtos (1) </td><td>4 </td></tr>
<tr>
<td>postPacketTotalCount </td><td>ifOutUcastPkts (1) </td><td>4 </td></tr>
<tr>
<td>egressBroadcastPacketTotalCount </td><td>ifOutBroadcastPkts (1) </td><td>4 </td></tr>
<tr>
<td>selectorId </td><td>Message Header Data </td><td>4 </td></tr>
</table>
<p>fbCollectorSFlowMissed() can be used to retrieve the number of potential missed export packets. This is not the number of FLOW samples that the collector has missed. Fixbuf tries to account for any reboot of the device and not count large sequence number discrepancies in it's missed count.</p>
<p>Fixbuf will return FB_ERROR_SFLOW if it tries to process any malformed samples. </p>
</div></div><!-- contents -->
      </div><!-- l-content -->
      <div id="l-footer">&copy; 2006-2017 Carnegie Mellon University</div>
    </div><!-- p-body -->
</body>
</html>   
